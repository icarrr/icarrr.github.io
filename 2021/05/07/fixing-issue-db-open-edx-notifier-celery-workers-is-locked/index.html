<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/WebPage">
  <head>
  <title>Fixing Issue DB Open edX Notifier Celery Workers is Locked</title>
  
  <meta http-equiv="cache-control" content="public, max-age=31536000" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Faizar Septiawan">
  <meta name="description" content="Catch your problem solution or read interesting stories on my blog! | Palugada paling ganteng di Makassar | #Cyclist Enthusiast | Palugada paling gila di Makassar | Read - Search - Ask | Sekali Gila Tetap Gila">
  <meta name="keywords" content="Activities, Android Developer, Ansible, Apache2, Atlassian, Ayo Belajar Linux, Bestpath Network, BLC Telkom Klaten, BSD, Caddy Server, Case Study, Cisco, Cisco Indonesia, Cloud Computing, Cockpit, Custom Weapons, Docker, E-Learning, Engenius, Error, FreeBSD, FreeBSD Indonesia, Komunitas Pengguna Linux Indonesia, KPLI Bulukumba, KPLI Klaten, Lets Encrypt, Linux, MacOS, Microsoft Azure, Microsoft SQL Server, MikroTik, MikroTik Indonesia, MySQL, Nginx, Open edX, OpenSID, Others, PHP, phpMyAdmin, PostgreSQL, Proxmox, Python, Redash, Sendy, SSH, Stories, Subnetting, TP-Link, Ubiquiti, Unix, Virtualization, Windows, X-Mosque, Faizar Septiawan, Icar, siBunglonGanteng, Orang Ganteng, siBunglonLabs, Programmer, SysAdmin, Site Reliability Engineer, Developer, Palugada, Makassar, Ganteng, Gila, Cyclist, Panglima, Setan, Panglima Setan, sibunglon, Ganteng">

  <!-- Open Graph data -->
  <meta property="og:url" content="https://sibunglon.com/2021/05/07/fixing-issue-db-open-edx-notifier-celery-workers-is-locked/">
  <meta property="og:site_name" content="Faizar Septiawan - Palugada paling ganteng di Makassar">
  <meta property="og:title" content="Fixing Issue DB Open edX Notifier Celery Workers is Locked">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-05-07T22:20:17+08:00">
    <meta property="article:modified_time" content="2021-05-07T22:20:17+08:00">
    <meta property="article:tag" content="Ayo Belajar Linux">
    <meta property="article:tag" content="Open EdX">
    <meta property="article:tag" content="Error">
    <meta property="og:image" content="https://sibunglon.com/assets/img/profil-cycling-4.jpg">


  <!-- schema data -->
  
  <meta itemprop="name" content="Fixing Issue DB Open edX Notifier Celery Workers is Locked">
  <meta itemprop="datePublished" content="2021-05-07T22:20:17+08:00">
  <meta itemprop="dateModified" content="2021-05-07T22:20:17+08:00">
  <meta itemprop="wordCount" content="334">
  <meta itemprop="image" content="https://sibunglon.com/assets/img/profil-cycling-4.jpg">
  <meta itemprop="keywords" content="Ayo Belajar Linux,Open EdX,Error">

  <!-- Twitter cards data -->
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://sibunglon.com/assets/img/profil-cycling-4.jpg">
  <meta name="twitter:title" content="Fixing Issue DB Open edX Notifier Celery Workers is Locked">

  

  
  <meta name="google-site-verification" content="SYE8MCa03gDSATy55M-WppXlauxSYqxjOE9Tg7vEJpM" />
  
  
  
  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L0K35LHNTF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-L0K35LHNTF');
  </script>
  
  

  
  
  
  
  
  <link rel="stylesheet" href="/assets/css/external.min.css" media="screen">
  
  
  <link rel="stylesheet" href="/assets/css/styles.css" media="screen">
  <link src="/assets/custom/googlefonts/roboto.css" rel="stylesheet">
  

  
  
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/src/images/apple-touch-icon.png">
  <link rel="shortcut icon" href="/src/images/favicon.ico">
  

  
  <!-- RSS -->
  <link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="Faizar Septiawan - Palugada paling ganteng di Makassar" />
  

  
  
  <script defer src="/assets/custom/fontawesome-5.15.1/js/all.min.js"></script>
  
  
</head>

  <body>
    
      <nav>
  <a href="/">
    siBunglon
  </a>
  <a href="/posts">
    Posts
  </a>
</nav>

    
    <main class="container">
      
  <article>
    <header>
      <small>
        <span class="date">May 7, 2021</span></small>
      <h1>Fixing Issue DB Open edX Notifier Celery Workers is Locked</h1>
    </header>
    <section><p><img src="/assets/img/Open-edX/open-edx-new.png" alt="Activities, Android Developer, Ansible, Apache2, Atlassian, Ayo Belajar Linux, Bestpath Network, BLC Telkom Klaten, BSD, Caddy Server, Case Study, Cisco, Cisco Indonesia, Cloud Computing, Cockpit, Custom Weapons, Docker, E-Learning, Engenius, Error, FreeBSD, FreeBSD Indonesia, Komunitas Pengguna Linux Indonesia, KPLI Bulukumba, KPLI Klaten, Lets Encrypt, Linux, MacOS, Microsoft Azure, Microsoft SQL Server, MikroTik, MikroTik Indonesia, MySQL, Nginx, Open edX, OpenSID, Others, PHP, phpMyAdmin, PostgreSQL, Proxmox, Python, Redash, Sendy, SSH, Stories, Subnetting, TP-Link, Ubiquiti, Unix, Virtualization, Windows, X-Mosque, Faizar Septiawan, Icar, siBunglonGanteng, Orang Ganteng, siBunglonLabs, Programmer, SysAdmin, Site Reliability Engineer, Developer, Palugada, Makassar, Ganteng, Gila, Cyclist, Panglima, Setan, Panglima Setan, sibunglon, Ganteng"></p>
<p>Apart from the <a href="/2020/04/19/fixing-issue-celery-open-edx-setelah-migrasi-instance/">issue user celery does not exist after migrated or upgrade the instance</a>, there are other possible issues that may be encountered after migrating instances, i.e. service <em>notifier-celery-workers</em> failed to start (FATAL, Exited too quickly).</p>
<p>Issue notifier-celery-workers failing to start may be encountered after migrate the instances because before migration,
the service has not been turned off while the service is serving several transactional queries so the database used by the service is locked (especially if you are still using SQLite), which means that the service cannot read or write data to the database.</p>
<p>I have encountered this issue and when I look at the log service notifier-celery-workers, I find logs like the following:</p>
<pre tabindex="0"><code class="language-log" data-lang="log">$ sudo tail /edx/var/log/supervisor/notifier-celery-workers-std{out,err}.log
==&gt; /edx/var/log/supervisor/notifier-celery-workers-stdout.log &lt;==
- *** --- * --- .&gt; concurrency: 4 (prefork)
-- ******* ----
--- ***** ----- [queues]
 -------------- .&gt; celery           exchange=celery(direct) key=celery


[tasks]
  . notifier.tasks.do_forums_digests
  . notifier.tasks.generate_and_send_digests


==&gt; /edx/var/log/supervisor/notifier-celery-workers-stderr.log &lt;==
    return self.cursor.execute(sql, params)
  File &#34;/edx/app/notifier/virtualenvs/notifier/local/lib/python2.7/site-packages/django/db/utils.py&#34;, line 98, in __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File &#34;/edx/app/notifier/virtualenvs/notifier/local/lib/python2.7/site-packages/django/db/backends/utils.py&#34;, line 64, in execute
    return self.cursor.execute(sql, params)
  File &#34;/edx/app/notifier/virtualenvs/notifier/local/lib/python2.7/site-packages/django/db/backends/sqlite3/base.py&#34;, line 318, in execute
    return Database.Cursor.execute(self, query, params)
OperationalError: database is locked
</code></pre><p>The issue was successfully fixed with steps:</p>
<ol>
<li>From the current user on the server, change to user <em>notifier</em>.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo -H -u notifier bash
</span></span></code></pre></div><ol start="2">
<li>Change to the database notifier directory and back up then delete the currently used database.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ <span class="nb">cd</span> ~/db
</span></span><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ cp notifier.db notifier.db.bak
</span></span><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ rm -f notifier.db
</span></span></code></pre></div><ol start="3">
<li>Run the database migration, so that a new database will be created.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ <span class="nb">cd</span> ~/src
</span></span><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ python manage.py migrate
</span></span></code></pre></div><ol start="4">
<li>Go back to the database directory, change the file permissions so that the service can write data and return to the user that was previously used (user non edX).</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ <span class="nb">cd</span> ~/db
</span></span><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ chmod <span class="m">664</span> notifier.db
</span></span><span class="line"><span class="cl"><span class="o">(</span>notifier<span class="o">)</span> $ <span class="nb">exit</span>
</span></span></code></pre></div><ol start="5">
<li>Restart all services of Open edX.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo /edx/bin/supervisorctl restart all
</span></span></code></pre></div><p>Check the service status periodically and pay attention to the log service, make sure the service is run or not error.</p>
</section>
    <footer>
      <hr>
      <div class="meta">
        <p class="tags">
          
            
              <a href="/tags/ayo-belajar-linux">
                <span>#</span>Ayo Belajar Linux</a>
            
              <a href="/tags/open-edx">
                <span>#</span>Open edX</a>
            
              <a href="/tags/error">
                <span>#</span>Error</a>
            
          
        </p>
      </div>
      <hr>
      <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "sibunglonlabs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>
  </article>

    </main>
    
      <footer>
  <p>
    &copy; 2024 Faizar Septiawan. <a href="http://creativecommons.org/licenses/by-sa/4.0/">Some Rights Reserved</a>.
  </p>
  <p>
    Powered by <a href="https://gohugo.io" title="A Fast and Flexible Website Generator">Hugo</a> &amp; <a href="https://github.com/eshlox/simplicity" title="Hugo theme">Simplicity</a>.
  </p>
</footer>

    
    
    
    
    
    
    
    <script src="/assets/js/scripts.min.js"></script>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L0K35LHNTF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-L0K35LHNTF');
    </script>
    
  </body>
</html>
