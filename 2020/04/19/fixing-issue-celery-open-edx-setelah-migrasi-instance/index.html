<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/WebPage">
  <head>
  <title>Fixing Issue Celery Open edX Setelah Migrasi Instance</title>
  
  <meta http-equiv="cache-control" content="public, max-age=31536000" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Faizar Septiawan">
  <meta name="description" content="Read - Search - Ask | Personal Site | Catch your problem solution or read interesting stories on my blog!">
  <meta name="keywords" content="Activities, Android Developer, Ansible, Apache2, Atlassian, Ayo Belajar Linux, Bestpath Network, BLC Telkom Klaten, BSD, Caddy Server, Case Study, Cisco, Cisco Indonesia, Cloud Computing, Cockpit, Custom Weapons, Docker, E-Learning, Engenius, Error, FreeBSD, FreeBSD Indonesia, Komunitas Pengguna Linux Indonesia, KPLI Bulukumba, KPLI Klaten, Lets Encrypt, Linux, MacOS, Microsoft Azure, Microsoft SQL Server, MikroTik, MikroTik Indonesia, MySQL, Nginx, Open edX, OpenSID, Others, PHP, phpMyAdmin, PostgreSQL, Proxmox, Python, Redash, Sendy, SSH, Stories, Subnetting, TP-Link, Ubiquiti, Unix, Virtualization, Windows, X-Mosque, Faizar Septiawan, Icar, siBunglonGanteng, Orang Ganteng, siBunglonLabs">
  
  
  
  <meta name="google-site-verification" content="SYE8MCa03gDSATy55M-WppXlauxSYqxjOE9Tg7vEJpM" />
  
  
  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110194945-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-110194945-3');
  </script>
  
  

  
  
  
  
  
  <link rel="stylesheet" href="/assets/css/external.min.css" media="screen">
  
  
  <link rel="stylesheet" href="/assets/css/styles.css" media="screen">
  <link src="/assets/custom/googlefonts/roboto.css" rel="stylesheet">
  

  
  
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/src/images/apple-touch-icon.png">
  <link rel="shortcut icon" href="/src/images/favicon.ico">
  

  
  <link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="The Official Site of siBunglon" />

  <meta property="og:title" content="Fixing Issue Celery Open edX Setelah Migrasi Instance" />
<meta property="og:description" content="Beberapa hari yang lalu saya memindahkan instance Open edX dan beberapa menit setelah server aktif, Open edX tidak bisa diakses. Cek servicenya, tetapi semua service dalam keadaan aktif namun ketika melihat lognya, ternyata ada error pada celery, kurang lebih errornya seperti berikut:
$ sudo tail -f /edx/var/log/{lms,cms,nginx}/*log ==&gt; /edx/var/log/lms/edx.log &lt;== Apr 12 02:21:16 beep [service_variant=lms][celery.worker.consumer][env:sandbox] ERROR [beep 1400] [consumer.py:364] - consumer: Cannot connect to amqp://celery:**@127.0.0.1:5672//: [Errno 104] Connection reset by peer." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sibunglon.com/2020/04/19/fixing-issue-celery-open-edx-setelah-migrasi-instance/" /><meta property="og:image" content="https://sibunglon.com/assets/img/profil.webp"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-19T22:38:14+07:00" />
<meta property="article:modified_time" content="2020-04-19T22:38:14+07:00" /><meta property="og:site_name" content="The Official Site of siBunglon" />


  <meta itemprop="name" content="Fixing Issue Celery Open edX Setelah Migrasi Instance">
<meta itemprop="description" content="Beberapa hari yang lalu saya memindahkan instance Open edX dan beberapa menit setelah server aktif, Open edX tidak bisa diakses. Cek servicenya, tetapi semua service dalam keadaan aktif namun ketika melihat lognya, ternyata ada error pada celery, kurang lebih errornya seperti berikut:
$ sudo tail -f /edx/var/log/{lms,cms,nginx}/*log ==&gt; /edx/var/log/lms/edx.log &lt;== Apr 12 02:21:16 beep [service_variant=lms][celery.worker.consumer][env:sandbox] ERROR [beep 1400] [consumer.py:364] - consumer: Cannot connect to amqp://celery:**@127.0.0.1:5672//: [Errno 104] Connection reset by peer."><meta itemprop="datePublished" content="2020-04-19T22:38:14+07:00" />
<meta itemprop="dateModified" content="2020-04-19T22:38:14+07:00" />
<meta itemprop="wordCount" content="229"><meta itemprop="image" content="https://sibunglon.com/assets/img/profil.webp"/>
<meta itemprop="keywords" content="Ayo Belajar Linux,Open edX,Error," />
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://sibunglon.com/assets/img/profil.webp"/>

<meta name="twitter:title" content="Fixing Issue Celery Open edX Setelah Migrasi Instance"/>
<meta name="twitter:description" content="Beberapa hari yang lalu saya memindahkan instance Open edX dan beberapa menit setelah server aktif, Open edX tidak bisa diakses. Cek servicenya, tetapi semua service dalam keadaan aktif namun ketika melihat lognya, ternyata ada error pada celery, kurang lebih errornya seperti berikut:
$ sudo tail -f /edx/var/log/{lms,cms,nginx}/*log ==&gt; /edx/var/log/lms/edx.log &lt;== Apr 12 02:21:16 beep [service_variant=lms][celery.worker.consumer][env:sandbox] ERROR [beep 1400] [consumer.py:364] - consumer: Cannot connect to amqp://celery:**@127.0.0.1:5672//: [Errno 104] Connection reset by peer."/>

  

  
  
  <script defer src="/assets/custom/fontawesome-5.15.1/js/all.min.js"></script>
  
  
</head>

  <body>
    
      <nav>
  <a href="/">
    siBunglon
  </a>
  <a href="/posts">
    Posts
  </a>
</nav>

    
    <main class="container">
      
  <article>
    <header>
      <small>
        <span class="date">April 19, 2020</span></small>
      <h1>Fixing Issue Celery Open edX Setelah Migrasi Instance</h1>
    </header>
    <section><p><img src="/assets/img/Open-edX/open-edx-new.png" alt="Activities, Android Developer, Ansible, Apache2, Atlassian, Ayo Belajar Linux, Bestpath Network, BLC Telkom Klaten, BSD, Caddy Server, Case Study, Cisco, Cisco Indonesia, Cloud Computing, Cockpit, Custom Weapons, Docker, E-Learning, Engenius, Error, FreeBSD, FreeBSD Indonesia, Komunitas Pengguna Linux Indonesia, KPLI Bulukumba, KPLI Klaten, Lets Encrypt, Linux, MacOS, Microsoft Azure, Microsoft SQL Server, MikroTik, MikroTik Indonesia, MySQL, Nginx, Open edX, OpenSID, Others, PHP, phpMyAdmin, PostgreSQL, Proxmox, Python, Redash, Sendy, SSH, Stories, Subnetting, TP-Link, Ubiquiti, Unix, Virtualization, Windows, X-Mosque, Faizar Septiawan, Icar, siBunglonGanteng, Orang Ganteng, siBunglonLabs"></p>
<p>Beberapa hari yang lalu saya memindahkan instance Open edX dan beberapa menit setelah server aktif, Open edX tidak bisa diakses. Cek servicenya, tetapi semua service dalam keadaan aktif namun ketika melihat lognya, ternyata ada error pada celery, kurang lebih errornya seperti berikut:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo tail -f /edx/var/log/<span class="o">{</span>lms,cms,nginx<span class="o">}</span>/*log
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; /edx/var/log/lms/edx.log &lt;<span class="o">==</span>
</span></span><span class="line"><span class="cl">Apr <span class="m">12</span> 02:21:16 beep <span class="o">[</span><span class="nv">service_variant</span><span class="o">=</span>lms<span class="o">][</span>celery.worker.consumer<span class="o">][</span>env:sandbox<span class="o">]</span> ERROR <span class="o">[</span>beep  1400<span class="o">]</span> <span class="o">[</span>consumer.py:364<span class="o">]</span> - consumer: Cannot connect to amqp://celery:**@127.0.0.1:5672//: <span class="o">[</span>Errno 104<span class="o">]</span> Connection reset by peer.
</span></span><span class="line"><span class="cl">Trying again in 32.00 seconds...
</span></span></code></pre></div><p>Dari log diatas, terdapat error message <code>Connection reset by peer</code>, penyebab issue tersebut sebenarnya sudah jelas yaitu kesalahan autentikasi.</p>
<p>Maka perlu dilakukan validasi, apakah user tersebut available atau tidak. Untuk melakukan validasi user, dapat menggunakan command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo rabbitmqctl authenticate_user userCeleryedX passwordCeleryedX
</span></span></code></pre></div><p>Ganti value <em>userCeleryedX</em> dan <em>passwordCeleryedX</em> sesuai user yang digunakan oleh instance tersebut, dapat dicek dari file <em>lms.auth.json</em> dan <em>cms.auth.json</em>.</p>
<p>Jika setelah menjalankan command validasi validasi user terdapat error messege <code>Error: failed to authenticate user</code>, berarti perlu dilakukan pembuatan user tersebut.</p>
<p>Buat user celery dengan menggunakan password yang sama pada file <em>lms.auth.json</em> dan <em>cms.auth.json</em>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo rabbitmqctl add_user userCeleryedX passwordCeleryedX
</span></span></code></pre></div><p>Ganti value <em>userCeleryedX</em> dan <em>passwordCeleryedX</em> sesuai user yang digunakan oleh instance tersebut, dapat dicek dari file <em>lms.auth.json</em> dan <em>cms.auth.json</em>.</p>
<p>Set permission untuk user celery yang baru saja dibuat.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo rabbitmqctl set_permissions -p / userCeleryedX <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span> <span class="s2">&#34;.*&#34;</span>
</span></span></code></pre></div><p>Restart service Open edX</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo /edx/bin/supervisorctl restart all
</span></span></code></pre></div><h3 id="references">References</h3>
<ul>
<li><a href="https://oonlab.com/edx/code/2015/10/21/solve-celery-error-saat-migrasi-open-edx/">oonlab</a></li>
<li><a href="https://blog.lawrencemcdaniel.com/open-edx-trouble-shooting-celery-rabbitmq/">Lawrence McDaniel Blog</a></li>
</ul>
</section>
    <footer>
      <hr>
      <div class="meta">
        <p class="tags">
          
            
              <a href="/tags/ayo-belajar-linux">
                <span>#</span>Ayo Belajar Linux</a>
            
              <a href="/tags/open-edx">
                <span>#</span>Open edX</a>
            
              <a href="/tags/error">
                <span>#</span>Error</a>
            
          
        </p>
      </div>
      <hr>
      <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "sibunglonlabs" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>
  </article>

    </main>
    
      <footer>
  <p>
    &copy; 2022 Faizar Septiawan. <a href="http://creativecommons.org/licenses/by-sa/4.0/">Some Rights Reserved</a>.
  </p>
  <p>
    Powered by <a href="https://gohugo.io" title="A Fast and Flexible Website Generator">Hugo</a> &amp; <a href="https://github.com/eshlox/simplicity" title="Hugo theme">Simplicity</a>.
  </p>
</footer>

    
    
    
    
    
    
    
    <script src="/assets/js/scripts.min.js"></script>
    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-110194945-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </body>
</html>
